<!-- templates/payment_methods/payment_methods.html -->
{% extends "base.html" %}

{% block content %}
{% include 'components/nav_user_config.html' %}

        <h3 class="mb-4">Способы оплаты</h3>

        <a href="/payment/create" id="addPaymentMethodBtn" class="btn btn-primary mb-3">Добавить способ оплаты</a>

        <table class="table">
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Код</th>
                    <th>Активен</th>
                    <th>Действия</th>
                </tr>
            </thead>
            <tbody id="paymentMethodsBody"></tbody>
        </table>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const SiteUrl = "{{ site_url_and_port }}";
        const token = "{{ token }}";

        // Функция загрузки способов оплаты
        async function loadPaymentMethods() {
            try {
                const response = await fetch(`${SiteUrl}/payment-methods/?skip=0&limit=100`, {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Accept": "application/json"
                    }
                });

                if (!response.ok) {
                    throw new Error(`Ошибка: ${response.status}`);
                }

                const methods = await response.json();
                renderPaymentMethods(methods);
            } catch (error) {
                console.error("Ошибка при загрузке способов оплаты:", error);
                document.getElementById("paymentMethodsBody").innerHTML = "<tr><td colspan='4'>Ошибка загрузки данных</td></tr>";
            }
        }

        // Рендеринг списка способов оплаты
        function renderPaymentMethods(methods) {
            const tbody = document.getElementById("paymentMethodsBody");
            tbody.innerHTML = "";

            if (methods && methods.length > 0) {
                methods.forEach(method => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${method.name || ""}</td>
                        <td>${method.code || ""}</td>
                        <td>${method.is_active ? "Да" : "Нет"}</td>
                        <td>
                            <a href="/payment/edit/${method.id}" class="btn btn-sm btn-warning">U</a>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                tbody.innerHTML = "<tr><td colspan='4'>Нет способов оплаты.</td></tr>";
            }
        }

        // Начальная загрузка
        loadPaymentMethods();
    </script>
{% endblock %}